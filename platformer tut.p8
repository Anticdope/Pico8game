pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
-- variables

function _init()
  player={
   sp=1,
   x=59,
   y=59,
   w=8,
   h=8,
   flp=false,
   
   --change in speed
   dx=0,
   dy=0,
   
   --max speed
   max_dx=2,
   max_dy=3,
   
   --acceleration
   acc=0.5,
   --jump  boost
   boost=4,
   --reset animation
   anim=0,
   
   --movement types
   running=false,
   jumping=false,
   sliding=false,
   landing=false
   } 
   
   gravity=0.3
   friction=0.85
end



-->8
--update and draw

function _update()
 player_update()
 player_animate()
end

function _draw()
 cls( )
 map(0,0)
 spr(player.sp,
     player.x,player.y,
     1,1,player.flp)


end
-->8
--collisions

function collide_map(obj,aim,flag)
 -- obj = player (so a table), needs x y w h
 -- aim = up down left right
 
 local x=obj.x local y=obj.y
 local w=obj.w local h=obj.h
 
 local x1=0 local y1=0
 local x2=0 local y2=0
 
 if aim=="left" then
  x1=x-1 y1=y
  x2=x   y2=y+h-1
 
 elseif aim=="right" then
  x1=x+w   y1=y
  x2=x+w+1 y2=y+h-1
 elseif aim=="up" then
  x1=x+1   y1=y-1
  x2=x+w-1 y2=y
 elseif aim=="down" then
  x1=x   y1=y+h
  x2=x+w y2=y+h
 else
 
 end
 
  --pixels to tiles
  x1/=8  y1/=8
  x2/=8 y2/=8
  
  if fget(mget(x1,y1),flag)
   or fget(mget(x1,y2),flag)
   or fget(mget(x2,y1),flag)
   or fget(mget(x2,y2),flag) then
  
   return true
  else
  
   return false
  end


end
-->8
--player

function player_update()
 --physics
 player.dy+=gravity
 player.dx*=friction
 
 if btn(⬅️) then
  player.dx-=player.acc
  player.running=true
  player.flp=true
 end
 if btn(➡️) then
  player.dx+=player.acc
  player.running=true
  player.flp=false
 end
 
   --slide
	if player.running
	and not btn(⬅️)
	and not btn(➡️)
	and not player.falling
	and not player.jumping then
	    player.running=false
	    player.sliding=true
	end

  --jump
	if btnp(❎)
	and player.landed then
	    sfx(0)
	    player.dy-=player.boost
	    player.landed=false
	end

--collision up and down

if player.dy>0 then
 player.falling=true
 player.landed=false
 player.jumping=false
 
 player.dy=limit_speed(player.dy,player.max_dy)
 
 if collide_map(player,"down",0) then 
  player.landed=true
  player.falling=false
  player.dy=0
  player.y-=(player.y+player.h)%8
 end
 
elseif player.dy<0 then
 player.jumping=true
 if collide_map(player,"up",1) then
  player.dy=0
 end
 
end

--check collision left and right

if player.dx<0 then
  player.dx=limit_speed(player.dx,player.max_dx)
 if collide_map(player, "left",1) then
  player.dx=0
 end
elseif player.dx>0 then
  player.dx=limit_speed(player.dx,player.max_dx)
 if collide_map(player, "right",1) then
  player.dx=0
 end
end

--stop sliding
if player.sliding then
 if abs(player.dx)<.2
 or player.running then
  player.dx=0
  player.sliding=false
 end
end


player.x+=player.dx
player.y+=player.dy

end

function player_animate()

  if player.jumping then
    player.sp=7
  elseif player.falling then
    player.sp=8
  elseif player.sliding then
    player.sp=9
  elseif player.running then
    if time()-player.anim>.1 then
      player.anim=time()
      player.sp+=1
      if player.sp>6 then
        player.sp=3
      end
    end  
  else --player idle
    if time()-player.anim>.3 then
      player.anim=time()
      player.sp+=1
      if player.sp>2 then
        player.sp=1
      end
    end
  end
end

function  limit_speed(num,maximum) 

 return mid(-maximum,num,maximum)

end
__gfx__
0000000000444440004444400004444400044444000444440004444400044444c004444400000000000000000000000000000000000000000000000000000000
0000000000ccccc000ccccc00ccccccc0c0cccccc00cccccc0cccccc00cccccc0ccccccc04444400000000000000000000000000000000000000000000000000
007007000cf72f200cf72f20c00ff72fc0cff72f0ccff72f0c0ff72f0c0ff72f000ff72f0ccccc00000000000000000000000000000000000000000000000000
000770000cfffff00cfffef0000ffffe000ffffe000ffffe000ffffec00ffffe000ffffecf72f200000000000000000000000000000000000000000000000000
00077000000cc00000cccc000fccc0000fccc0000fccc0000fccc00000ccc0000000ccc0cfffff00000000000000000000000000000000000000000000000000
0070070000cccc000f0cc0f0000cc000000cc000000cc000000cc0000f0cc0000000cc0f00ccccf0000000000000000000000000000000000000000000000000
000000000f0cd0f0000cd0000cc0d00000cd00000dd0c00000dc000000dc000000000c500f0ccd00000000000000000000000000000000000000000000000000
0000000000c00d0000c00d000000d00000cd00000000c00000dc00000dc00000000000c50000ccdd000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb00bbbbbbbbbbbb00444445440000000000000000000000000000000000000000000000000000000000000000
bbbbb3bbbbbbb3bbbbbbbbbbbbbbbbbbbbbbbbbb0bbbb3bbbbbbbbb0444444440000000000000000000000000000000000000000000000000000000000000000
3bb3343b33b3b43bb3b333b3b333b3b3b333b3b3bbb3343bb3b3bbbb444944540000000000000000000000000000000000000000000000000000000000000000
3b3444433434b443bb344434bb9bb434bb4bb434b3344443b3b433bb444444440000000000000000000000000000000000000000000000000000000000000000
43944494494435443b34d4443b4b34443b4b3444b3444444343434bb444444440000000000000000000000000000000000000000000000000000000000000000
4344444444444444434444444343345443433444b34444544444443b444444440000000000000000000000000000000000000000000000000000000000000000
4444d444d4444494444444944444444d44444494b34494444444d43b49444d440000000000000000000000000000000000000000000000000000000000000000
4f4444444d4444444944444444444444494444443d44444444444443444444440000000000000000000000000000000000000000000000000000000000000000
44444544444444444444444444444444454444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444d44444444644444444444444540000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4449445444d4744444944d444d444944444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
444444444444474444444444444444444444e4740000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
444444444544447442244444454444444d4444770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444442e24444444444444444447640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
49444d44449444442244444444544449444776440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44444444444444444444449444444444444474440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333334444444444444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbb3bbbbbbbbb3b9999499999999949000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbb3bbbbbbbbb3bb9994999999999499000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333334444444444444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b3bbbb3bbbb3bbbb9499994999949999000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bb3bbb3bbbb3bbbb9949994999949999000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333334444444444444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
003bb300000000000049940000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
003bb300003bb3000049940000499400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0033b300003bb3000044940000499400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
003bb300003bb3000049940000499400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
003bb300003333000049940000444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
003bb300003bb3000049940000499400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
003b3300003bb3000049440000499400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
003bb300003bb3000049940000499400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
003bb300003bb3000049940000499400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003030303010303030000000000000000030303030300000000000000000000000101010100000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6061606100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7100700000606161616000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7000710000700000007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7000700000700000007100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7100700000700062636363636263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7000606160610073007100007300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7000700070000072007100007300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7100710071000045467100007200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7000700071004553544441467200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4442424442425353535353534141424100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5050525450535051505052505053545000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000200000f02010030110401205015050260502702029010000000200002000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001000013030110200c0200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
